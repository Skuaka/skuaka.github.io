<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Skuaka">


    
    


<meta name="description" content="For you, a thousand times over.">
<meta name="keywords" content="skuaka">
<meta property="og:type" content="website">
<meta property="og:title" content="Skuaka">
<meta property="og:url" content="http://blog.skuaka.cn/page/4/index.html">
<meta property="og:site_name" content="Skuaka">
<meta property="og:description" content="For you, a thousand times over.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Skuaka">
<meta name="twitter:description" content="For you, a thousand times over.">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Skuaka" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/avatar.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Skuaka</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: false
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Skuaka</a></h1>
        </hgroup>

        
        <p class="header-subtitle">For you, a thousand times over.</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>Menu</li>
                        <li>Tags</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">Home</a></li>
                        
                            <li><a href="/archives/">Archives</a></li>
                        
                            <li><a href="/tags/">Tags</a></li>
                        
                            <li><a href="/about/">about</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:skuaka@icloud.com" title="Email"></a>
                            
                                <a class="fa bilibili" href="https://space.bilibili.com/5006495" title="bilibili"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/unp/"><unp></unp></a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/">Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CCIE/">CCIE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/">CMake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDos/">DDos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DTD/">DTD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/">Database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DoNotStarve/">DoNotStarve</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dreamweaver/">Dreamweaver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Game/">Game</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/">IO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Job/">Job</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/">Kali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Makefile/">Makefile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MetaProgram/">MetaProgram</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mp3/">Mp3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/">Network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Op-System/">Op-System</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Perl/">Perl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QT/">QT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raspberrypi/">Raspberrypi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLserver/">SQLserver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Security/">Security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tcp-ip/">Tcp/ip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vultr/">Vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wifi/">Wifi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wireshark/">Wireshark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XML/">XML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/">apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/base64/">base64</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcc-gdb/">gcc,gdb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macOS/">macOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openSSL/">openSSL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postman/">postman</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/robotframework/">robotframework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/steamcmd/">steamcmd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/">sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swagger/">swagger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/travis/">travis</a></li></ul>
                    </div>
                </section>
                
                
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Skuaka</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Skuaka</a></h1>
            </hgroup>
            
            <p class="header-subtitle">For you, a thousand times over.</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">Home</a></li>
                
                    <li><a href="/archives/">Archives</a></li>
                
                    <li><a href="/tags/">Tags</a></li>
                
                    <li><a href="/about/">about</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:skuaka@icloud.com" title="Email"></a>
                            
                                <a class="fa bilibili" target="_blank" href="https://space.bilibili.com/5006495" title="bilibili"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="Tags" friends="Friends" about="About Me">
</nav>
      <div class="body-wrap">
  
    <article id="post-Algorithm/链表算法题笔记" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/08/24/Algorithm/链表算法题笔记/" class="article-date">
      <time datetime="2019-08-24T10:04:44.000Z" itemprop="datePublished">2019-08-24</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/24/Algorithm/链表算法题笔记/">链表算法题笔记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="链表算法题笔记"><a href="#链表算法题笔记" class="headerlink" title="链表算法题笔记"></a>链表算法题笔记</h2><h3 id="环形链表"><a href="#环形链表" class="headerlink" title="环形链表"></a>环形链表</h3><h4 id="判断链表是否有环"><a href="#判断链表是否有环" class="headerlink" title="判断链表是否有环"></a>判断链表是否有环</h4><ul>
<li>使用一个slow指针，一个fast指针。</li>
<li><p>slow指针一次往后遍历以1个节点，fast指针一次往后遍历2个节点，一直做这样的操作。</p>
</li>
<li><p>如果fast指针在遍历过程中，遍历到了NULL节点说明链表没有环。</p>
</li>
<li><p>否则当slow指针和falst指针相同，则说明环有节点。</p>
</li>
</ul>
<p>时间复杂度O(n)，空间复杂度O(1)。</p>
<h4 id="找出环形入口"><a href="#找出环形入口" class="headerlink" title="找出环形入口"></a>找出环形入口</h4><p>接着上面所述，我们假定链表头到环入口的距离是<code>len</code>，环入口到slow和fast交汇点的距离为<code>x</code>，环的长度为<code>R</code>。slow和fast第一次交汇时，设slow走的长度为：<code>d = len + x</code>，而fast走的长度为：<code>2d = len + nR + x, (n &gt;= 1)</code>，从而我们可以得知：<code>2len + 2x = len + nR + x</code>，即:<code>len = nR - x, (n &gt;= 1)</code>，于是我们可以得到这样的算法。</p>
<ul>
<li><p>使用一个cur指针指向链表头节点，一个inter指针指向第一次的交汇点。</p>
</li>
<li><p>cur指针和inter指针一起往后遍历。</p>
</li>
<li><p>cur指针和inter指针相等时，cur和inter指针指向的就是环的入口节点。</p>
</li>
</ul>
<p>inter指针在遍历过程中可能多次(n &gt;= 1)经过环入口节点，但当cur指针第一次达到入口节点时，inter指针此时必然也指向入口节点。</p>
<p>时间复杂度O(n)，空间复杂度O(1)。</p>
<h3 id="相交链表"><a href="#相交链表" class="headerlink" title="相交链表"></a>相交链表</h3><p>判断两个单链表是否相交，如果相交，给出相交的第一个点（两个链表都不存在环）。</p>
<p><strong>思路1</strong>：暴力，O(m*n)。对两个链表分别进行遍历，找到相同的节点即可。</p>
<p><strong>☆思路2</strong>：将其中一个链表首尾相连，检测另外一个链表是否存在环，如果存在，则两个链表相交，并且另一个链表的环入口即为相交的第一个点。时间复杂度为O(m+n)，空间复杂度为O(1)。</p>
<p><strong>思路3</strong>：使用哈希表，即python中的字典。先遍历一个链表，并将链表内容放入字典。再遍历另外一个链表，看遍历到的位置是否存在于字典中，存在则返回当前结点。若遍历结束仍不存在则返回空。检索复杂度为O(m+n)，空间复杂度O(m+n)。</p>
<p><strong>☆思路4</strong>：分别计算两个链表的长度。先读较长的链表，读到两个链表等长的时候再同时读两个链表，并判断两个链表遍历到的当前节点是否相同。时间复杂度为O(m+n)，空间复杂度为O(1)。</p>
<h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Algorithm/">Algorithm</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Algorithm/">Algorithm</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Database/Concept/事务加锁协议" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/07/29/Database/Concept/事务加锁协议/" class="article-date">
      <time datetime="2019-07-29T07:15:26.000Z" itemprop="datePublished">2019-07-29</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/29/Database/Concept/事务加锁协议/">事务加锁协议</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="事务加锁协议"><a href="#事务加锁协议" class="headerlink" title="事务加锁协议"></a>事务加锁协议</h2><p>看《高性能Mysql》的时候提到了<em>两段锁协议</em>，所以查了一下意思。</p>
<p>摘自：<a href="https://www.cnblogs.com/zszmhd/p/3365220.html" target="_blank" rel="noopener">https://www.cnblogs.com/zszmhd/p/3365220.html</a></p>
<p><strong>一次性锁协议</strong>，事务开始时，即一次性申请所有的锁，之后不会再申请任何锁，如果其中某个锁不可用，则整个申请就不成功，事务就不会执行，在事务尾端，一次性释放所有的锁。一次性锁协议不会产生死锁的问题，但事务的并发度不高。 </p>
<p><strong>两阶段锁协议</strong>，整个事务分为两个阶段，前一个阶段为加锁，后一个阶段为解锁。在加锁阶段，事务只能加锁，也可以操作数据，但不能解锁，直到事务释放第一个锁，就进入解锁阶段，此过程中事务只能解锁，也可以操作数据，不能再加锁。两阶段锁协议使得事务具有较高的并发度，因为解锁不必发生在事务结尾。它的不足是没有解决死锁的问题，因为它在加锁阶段没有顺序要求。如两个事务分别申请了A, B锁，接着又申请对方的锁，此时进入死锁状态。</p>
<p><strong>树形协议</strong>，假设数据项的集合满足一个偏序关系，访问数据项必须按此偏序关系的先后进行。如di-&gt;dj，则要想访问dj，必须先访问di。这种偏序关系导出一个有向无环图(DAG)，因此称为树形协议。树形协议的规则有：</p>
<ul>
<li>树形协议只有独占锁；</li>
<li>事务T第一次加锁可以对任何数据项进行；</li>
<li>此后，事务T对数据项Q的加锁前提是持有Q的父亲数据项的锁；</li>
<li>对数据项的解锁可以随时进行；</li>
<li>数据项被事务T加锁并解锁之后，就不能再被事务T加锁。</li>
</ul>
<p>树形协议的优点是并发度好，因为可以较早地解锁。并且没有死锁，因为其加锁都是顺序进行的。</p>
<p>缺点是对不需要访问的数据进行不必要的加锁。</p>
<p><strong>时间戳排序协议</strong>，每个事务都有一个唯一的时间戳，也就是其进入系统的时间。时间戳有大小之分，如果事务Ti比Tj先进入系统，则TS(Ti)&lt;TS(Tj)。对于每个数据项Q，有两个时间戳与其绑定：一个是W-TS(Q)，表示最近一次写数据项Q的事务的时间戳；一个是R-TS(Q)，表示最近一次读数据项Q的事务的时间戳。</p>
<p>Thomas协议是对时间戳排序协议的改进，具体内容如下：</p>
<p>若事务Ti发起一个write(Q)，则</p>
<ul>
<li>如果TS(Ti)&lt;R-TS(Q)，则表明Ti准备写的值还没来得及写入，Q就提前被读取了，所以Ti的write(Q)操作被拒绝，并且事务Ti被回滚。</li>
<li>如果TS(Ti)&lt;W-TS(Q)，表明Ti写的值已过期，比它更新的值已经写到Q上，所以Ti的write(Q)操作被拒绝。</li>
<li>剩下的情况，write(Q)操作被允许。 </li>
</ul>
<p><strong>多版本机制</strong></p>
<p>锁是针对集中式数据管理设计的，缺点是降低了事务的并发，并且锁本身有开销。在分布式系统，尤其是读多写少的系统中，采用多版本机制更合适。每个数据项都有多个副本，每个副本都有一个时间戳，根据多版本并发控制协议(MVCC)维护各个版本。</p>
<p>MVCC又称为乐观锁，它在读取数据项时，不加锁；在更新数据项时，直到最后要提交时，才会加锁。这与CAS(Compare and Swap)的机制很类似，为了提高并发度，它更新数据前，会将数据拷贝一份，进行一系列修改，并且拷贝的同时，会记录当前的版本号(时间戳)，当修改完毕，即将提交时，再检查此时的版本号是否与刚才记录的一致，如果不一致，则表明数据项被其他事务修改，当前事务的修改被取消。否则，正式提交修改，并增加版本号。</p>
<p>与MVCC相对，基于锁的并发控制机制称为悲观锁，因为它认为其他事务修改自己正在使用的数据项的概率很高，因此对数据项加锁以阻塞其他事务的读和写。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Database/">Database</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Database/">Database</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Python/virtualenv" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/06/24/Python/virtualenv/" class="article-date">
      <time datetime="2019-06-24T09:09:51.000Z" itemprop="datePublished">2019-06-24</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/Python/virtualenv/">virtualenv</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="virtualenv使用"><a href="#virtualenv使用" class="headerlink" title="virtualenv使用"></a>virtualenv使用</h3><ol>
<li><p>通过 pip 安装 virtualenv</p>
<p><code>pip install virtualenv</code></p>
</li>
<li><p>创建虚拟环境 my_venv</p>
<p><code>virtualenv my_venv</code></p>
<ul>
<li>virtualenv 会创建一个目录 <code>my_venv/</code>，目录结构：<ul>
<li><code>lib/</code>，包含虚拟环境中后续安装的软件包</li>
<li><code>include/</code>，包含支持Python的类库</li>
<li><code>bin/</code>，可执行文件</li>
<li><code>python</code>，可执行python的命令文件</li>
<li><code>pip</code>，辅助安装其他软件包的命令文件</li>
<li><code>setuptools</code></li>
</ul>
</li>
</ul>
</li>
<li><p>指定参数</p>
<ul>
<li><p>指定要使用的 Python 版本：</p>
<p><code>virtualenv -p /usr/bin/python2.7 my_venv</code></p>
<p>或者在 <code>~/.bashrc</code> 文件中设置环境变量</p>
<p><code>VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2.7</code></p>
</li>
<li><p>不继承全局软件包：</p>
<p><code>virtualenv --no-site-packages my_venv</code></p>
</li>
<li><p>继承全局软件包：</p>
<p><code>virtualenv --system-site-packages my_venv</code></p>
<blockquote>
<p>从virtualenv 1.7开始，默认不包含全局软件包；</p>
<p>全局软件包默认位于 <code>/usr/lib/python&lt;version&gt;/site-packages</code></p>
</blockquote>
</li>
</ul>
</li>
<li><p>激活运行环境：</p>
<p><code>source my_venv/bin/activate</code></p>
<blockquote>
<p>这条命令修改了当前用户的环境变量 <code>$PATH</code>，将我们新建的虚拟环境目录 <code>ENV/bin/</code> 作为第一个元素添加到了 $PATH 中。因为在Linux系统中输入命令时，命令可执行文件的搜索路径是根据 $PATH 中配置的路径的先后顺序来的，所以接下来你执行的所有命令都将是 <code>ENV/bin/</code> 中的命令（如果此目录中存在这个命令的话），新安装的模块都只会安装到该目录（ENV）中去。</p>
</blockquote>
<p>PS：有时候缺失这个脚本文件，重新创建一下虚拟环境。</p>
</li>
<li><p>在激活的虚拟环境中，通过pip安装其他必要的软件包。</p>
</li>
<li><p>注销虚拟环境：</p>
<p><code>deactivate</code></p>
</li>
<li><p>删除虚拟环境：</p>
<p><code>rm -rf my_venv</code></p>
</li>
<li><p>备份虚拟环境配置文件：</p>
<p><code>pip freeze &gt; requirements.txt</code></p>
</li>
<li><p>将备份文件还原到虚拟环境中：</p>
<p><code>pip install -r requirements.txt</code></p>
</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Python/">Python</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Database/Mysql/mysql-dual表" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/06/10/Database/Mysql/mysql-dual表/" class="article-date">
      <time datetime="2019-06-10T14:59:53.000Z" itemprop="datePublished">2019-06-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/10/Database/Mysql/mysql-dual表/">mysql-dual表</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="DUAL表"><a href="#DUAL表" class="headerlink" title="DUAL表"></a>DUAL表</h2><p>Oracle和MySQL中都有一张名称为dual的虚拟表，它们的作用和区别呢？</p>
<p>From: <a href="https://javawangbaofeng.iteye.com/blog/2242694" target="_blank" rel="noopener">https://javawangbaofeng.iteye.com/blog/2242694</a></p>
<h3 id="用处"><a href="#用处" class="headerlink" title="用处"></a>用处</h3><p>在MySQL中，对dual表的解释：</p>
<p>DUAL is purely for the convenience of people who require that all SELECT statements should have FROM and possibly other clauses.</p>
<p>纯粹是为了满足select … from…这一习惯问题，mysql会忽略对该表的引用。</p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><ul>
<li><p><code>select * from dual;</code></p>
<p>mysql会出错: 1096 - No tables used,</p>
<p>oracle 会返回列：“DUMMY”，其值为“X”, 行为和只有一行记录的普通表是一样的！</p>
</li>
<li><p><code>select express [from dual];</code></p>
<p>mysql总是作为返回该表达式值的普通select语句执行，返回一行记录的结果集，from dual 对mysql来说就是摆设。</p>
<ul>
<li><code>select 1 + 1;</code>  </li>
<li><code>select 1 + 1 from dual;</code>  </li>
</ul>
<p>这两句sql语句执行的结果是一样的。</p>
<p>oracle里该句必须有from dual；否则报错！</p>
</li>
<li><p><code>select express from dual where 0=2;</code></p>
<p>mysq 和 oracle的行为一致：会先计算where的条件，再行计算express；这里的where条件会决定expres是否会返回。</p>
<p>此时无论是Oracle还是MySQL都不可以省略from dual.</p>
</li>
</ul>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Mysql/">Mysql</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mysql/">Mysql</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Database/Mysql/mysql-EXPLAIN" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/05/27/Database/Mysql/mysql-EXPLAIN/" class="article-date">
      <time datetime="2019-05-27T13:51:33.000Z" itemprop="datePublished">2019-05-27</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/27/Database/Mysql/mysql-EXPLAIN/">mysql-EXPLAIN</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="MYSQL-EXPLAIN"><a href="#MYSQL-EXPLAIN" class="headerlink" title="MYSQL-EXPLAIN"></a>MYSQL-EXPLAIN</h2><p>学习自：</p>
<p><a href="https://segmentfault.com/a/1190000008131735" target="_blank" rel="noopener">https://segmentfault.com/a/1190000008131735</a></p>
<p><a href="http://www.cnitblog.com/aliyiyi08/archive/2008/09/09/48878.html" target="_blank" rel="noopener">http://www.cnitblog.com/aliyiyi08/archive/2008/09/09/48878.html</a></p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>MySQL 提供了一个 EXPLAIN 命令, 它可以对 <code>SELECT</code> 语句进行分析, 并输出 <code>SELECT</code> 执行的详细信息, 以供开发人员针对性优化.</p>
<p>EXPLAIN 命令用法十分简单, 在 <code>SELECT</code> 语句前加上 <code>Explain</code> 就可以了。</p>
<h3 id="EXPLAIN-输出格式"><a href="#EXPLAIN-输出格式" class="headerlink" title="EXPLAIN 输出格式"></a>EXPLAIN 输出格式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from user_info where id = 2\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: user_info</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: const</span><br><span class="line">possible_keys: PRIMARY</span><br><span class="line">          key: PRIMARY</span><br><span class="line">      key_len: 8</span><br><span class="line">          ref: const</span><br><span class="line">         rows: 1</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: NULL</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>各列的含义如下:</p>
<ul>
<li>id: SELECT 查询的标识符. 每个 SELECT 都会自动分配一个唯一的标识符.</li>
<li>select_type: SELECT 查询的类型.</li>
<li>table: 查询涉及的表或衍生表</li>
<li>partitions: 匹配的分区</li>
<li>type: join 类型</li>
<li>possible_keys: 此次查询中可能选用的索引</li>
<li>key: 此次查询中确切使用到的索引.</li>
<li>ref: 哪个字段或常数与 key 一起被使用</li>
<li>rows: 显示此查询一共扫描了多少行. 这个是一个估计值.</li>
<li>filtered: 表示此查询条件所过滤的数据的百分比</li>
<li>extra: 额外的信息</li>
</ul>
<h4 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h4><p><code>select_type</code> 表示了查询的类型, 它的常用取值有:</p>
<ul>
<li>SIMPLE, 表示此查询不包含 UNION 查询或子查询</li>
<li>PRIMARY, 表示此查询是最外层的查询</li>
<li>UNION, 表示此查询是 UNION 的第二或随后的查询</li>
<li>DEPENDENT UNION, UNION 中的第二个或后面的查询语句, 取决于外面的查询</li>
<li>UNION RESULT, UNION 的结果</li>
<li>SUBQUERY, 子查询中的第一个 SELECT</li>
<li>DEPENDENT SUBQUERY: 子查询中的第一个 SELECT, 取决于外面的查询. 即子查询依赖于外层查询的结果.</li>
</ul>
<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p><code>type</code> 字段比较重要, 它提供了判断查询是否高效的重要依据依据. 通过 <code>type</code> 字段, 我们判断此次查询是 <code>全表扫描</code> 还是 <code>索引扫描</code> 等.</p>
<ul>
<li><p><code>system</code>: 表中只有一条数据. 这个类型是特殊的 <code>const</code> 类型.</p>
</li>
<li><p><code>const</code>: 针对主键或唯一索引的等值查询扫描, 最多只返回一行数据. const 查询速度非常快, 因为它仅仅读取一次即可.</p>
</li>
<li><p><code>eq_ref</code>: 此类型通常出现在多表的 join 查询, 表示对于前表的每一个结果, 都只能匹配到后表的一行结果. 并且查询的比较操作通常是 <code>=</code>, 查询效率较高. </p>
</li>
<li><p><code>ref</code>: 此类型通常出现在多表的 join 查询, 针对于非唯一或非主键索引, 或者是使用了 <code>最左前缀</code> 规则索引的查询.</p>
</li>
<li><p><code>ref_or_null</code>: 该联接类型如同ref，但是添加了MySQL可以专门搜索包含NULL值的行.</p>
</li>
<li><p><code>index_merge</code>: 该联接类型表示使用了索引合并优化方法。在这种情况下，key列包含了使用的索引的清单，key_len包含了使用的索引的最长的关键元素.</p>
</li>
<li><p><code>unique_subquery</code></p>
</li>
<li><p><code>index_subquery</code></p>
</li>
<li><p><code>range</code>: 表示使用索引范围查询, 通过索引字段范围获取表中部分数据记录. 这个类型通常出现在 =, &lt;&gt;, &gt;, &gt;=, &lt;, &lt;=, IS NULL, &lt;=&gt;, BETWEEN, IN() 操作中.</p>
<p>当 <code>type</code> 是 <code>range</code> 时, 那么 EXPLAIN 输出的 <code>ref</code> 字段为 NULL, 并且 <code>key_len</code> 字段是此次查询中使用到的索引的最长的那个.</p>
</li>
<li><p><code>index</code>: 表示全索引扫描(full index scan), 和 ALL 类型类似, 只不过 ALL 类型是全表扫描, 而 index 类型则仅仅扫描所有的索引, 而不扫描数据.</p>
<p><code>index</code> 类型通常出现在: 所要查询的数据直接在索引树中就可以获取到, 而不需要扫描数据. 当是这种情况时, Extra 字段 会显示 <code>Using index</code>.</p>
</li>
<li><p>ALL: 表示全表扫描, 这个类型的查询是性能最差的查询之一. </p>
<p>通常来说, 我们的查询不应该出现 ALL 类型的查询, 因为这样的查询在数据量大的情况下, 对数据库的性能是巨大的灾难. 如一个查询是 ALL 类型查询, 那么一般来说可以对相应的字段添加索引来避免.</p>
</li>
</ul>
<h5 id="type-类型的性能比较"><a href="#type-类型的性能比较" class="headerlink" title="type 类型的性能比较"></a>type 类型的性能比较</h5><p><code>ALL &lt; index &lt; range ~ index_merge &lt; ref &lt; eq_ref &lt; const &lt; system</code></p>
<h4 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h4><p>表示查询优化器使用了索引的字节数. 这个字段可以评估组合索引是否完全被使用, 或只有最左部分字段被使用到.</p>
<h4 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h4><p>rows 也是一个重要的字段. MySQL 查询优化器根据统计信息, 估算 SQL 要查找到结果集需要扫描读取的数据行数.</p>
<p>这个值非常直观显示 SQL 的效率好坏, 原则上 rows 越少越好.</p>
<h4 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h4><p>EXplain 中的很多额外的信息会在 Extra 字段显示, 常见的有以下几种内容:</p>
<ul>
<li><p><code>Distinct</code> </p>
<p>一旦MYSQL找到了与行相联合匹配的行，就不再搜索了.</p>
</li>
<li><p><code>Not exists</code> </p>
<p>MYSQL优化了LEFT JOIN，一旦它找到了匹配LEFT JOIN标准的行， 就不再搜索了.</p>
</li>
<li><p><code>Range checked for each Record（index map:#）</code></p>
<p>没有找到理想的索引，因此对于从前面表中来的每一个行组合，MYSQL检查使用哪个索引，并用它来从表中返回行。这是使用索引的最慢的连接之一 .</p>
</li>
<li><p><code>Using filesort</code></p>
<p>看到这个的时候，表示 MySQL 需额外的排序操作, 不能通过索引顺序达到排序效果，查询需要优化了.</p>
</li>
<li><p><code>Using index</code></p>
<p>“覆盖索引扫描”, 表示查询在索引树中就可查找所需数据, 不用扫描表数据文件, 往往说明性能不错.</p>
</li>
<li><p><code>Using temporary</code></p>
<p>查询有使用临时表, 一般出现于排序, 分组和多表 join 的情况, 查询效率不高, 建议优化.</p>
</li>
<li><p><code>Using where</code>  </p>
<p>使用了WHERE从句来限制哪些行将与下一张表匹配或者是返回给用户。如果不想返回表中的全部行，并且连接类型ALL或index，这就会发生，或者是查询有问题.</p>
</li>
</ul>
<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Mysql/">Mysql</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mysql/">Mysql</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/Command/grep减号" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/05/18/Linux/Command/grep减号/" class="article-date">
      <time datetime="2019-05-18T07:13:26.000Z" itemprop="datePublished">2019-05-18</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/18/Linux/Command/grep减号/">shell double-dash(--)作用</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="如何grep一个-？"><a href="#如何grep一个-？" class="headerlink" title="如何grep一个 - ？"></a>如何grep一个 <code>-</code> ？</h3><p>起因，想知道如何grep一个中划线。</p>
<p>假如要查找一条命令的某个选项 <code>-a</code> ，即使用引号将 <code>-a</code> 括起来，也会报错。</p>
<p>因为 <code>-</code> (dash键) 是shell选项的前缀。只要它出现shell就会认为接下来跟着的是选项。</p>
<p><strong>两种解决方法</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cmd --<span class="built_in">help</span> | grep -e <span class="string">'-a'</span></span><br><span class="line">$ cmd --<span class="built_in">help</span> | grep -- -a</span><br></pre></td></tr></table></figure>
<p>第一个是grep的正则表达式，第二个是shell语法 <code>--</code>。</p>
<h3 id="double-dash-作用"><a href="#double-dash-作用" class="headerlink" title="double-dash (--) 作用"></a>double-dash (<code>--</code>) 作用</h3><p>来自：<a href="https://unix.stackexchange.com/questions/11376/what-does-double-dash-mean-also-known-as-bare-double-dash" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/11376/what-does-double-dash-mean-also-known-as-bare-double-dash</a></p>
<p>More precisely, a double dash (<code>--</code>) is used in bash built-in commands and many other commands to signify the end of command options, after which only positional parameters are accepted.</p>
<p>Example use: lets say you want to grep a file for the string <code>-v</code> - normally <code>-v</code> will be considered the option to reverse the matching meaning (only show lines that do not match), but with <code>--</code> you can grep for string <code>-v</code> like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -- -v file</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Security/linux服务器入侵检测" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/05/12/Security/linux服务器入侵检测/" class="article-date">
      <time datetime="2019-05-12T15:19:13.000Z" itemprop="datePublished">2019-05-12</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/12/Security/linux服务器入侵检测/">linux服务器入侵检测</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>source: <a href="https://bash-prompt.net/guides/server-hacked/" target="_blank" rel="noopener">https://bash-prompt.net/guides/server-hacked/</a></p>
<p>一篇翻译：<a href="https://linux.cn/article-9116-1.html" target="_blank" rel="noopener">https://linux.cn/article-9116-1.html</a></p>
<h1 id="How-To-Tell-If-Your-Linux-Server-Has-Been-Compromised"><a href="#How-To-Tell-If-Your-Linux-Server-Has-Been-Compromised" class="headerlink" title="How To Tell If Your Linux Server Has Been Compromised"></a>How To Tell If Your Linux Server Has Been Compromised</h1><p>A server being compromised or hacked for the purpose of this guide is an unauthorized person or bot logging into the server in order to use it for their own, usually negative ends.</p>
<p>Disclaimer: If your server has been compromised by a state organization like the NSA or a serious criminal group then you will not notice any problems and the following techniques will not register their presence.</p>
<p>However, the majority of compromised servers are carried out by bots i.e. automated attack programs, in-experienced attackers e.g. “script kiddies”, or dumb criminals.</p>
<p>These sorts of attackers will abuse the server for all it’s worth whilst they have access to it and take few precautions to hide what they are doing.</p>
<h2 id="Symptoms-of-a-compromised-server"><a href="#Symptoms-of-a-compromised-server" class="headerlink" title="Symptoms of a compromised server"></a>Symptoms of a compromised server</h2><p>When a server has been compromised by an in-experienced or automated attacker they will usually do something with it that consumes 100% of a resource. This resource will usually be either the CPU for something like crypt-currency mining or email spamming, or bandwidth for launching a DOS attack.</p>
<p>This means that the first indication that something is amiss is that the server is “going slow”. This could manifest in the website serving pages much slower than usual, or email taking many minutes to deliver or send.</p>
<p>So what should you look for?</p>
<h2 id="Check-1-Who’s-currently-logged-in"><a href="#Check-1-Who’s-currently-logged-in" class="headerlink" title="Check 1 - Who’s currently logged in?"></a>Check 1 - Who’s currently logged in?</h2><p>The first thing you should look for is who is currently logged into the server. It is not uncommon to find the attacker actually logged into the server and working on it.</p>
<p>The shell command to do this is <code>w</code>. Running <code>w</code> gives the following output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> 08:32:55 up 98 days,  5:43,  2 users,  load average: 0.05, 0.03, 0.00</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     pts/0    113.174.161.1    08:26    0.00s  0.03s  0.02s ssh root@coopeaa12</span><br><span class="line">root     pts/1    78.31.109.1      08:26    0.00s  0.01s  0.00s w</span><br></pre></td></tr></table></figure>
<p>One of those IP’s is a UK IP and the second is Vietnamese. That’s probably not a good thing.</p>
<p>Stop and take a breath, don’t panic and simply kill their SSH connection. Unless you can stop then re-entering the server they will do so quickly and quite likely kick you off and stop you getting back in.</p>
<p>Please see the <strong>What should I do if I’ve been compromised</strong> section at the end of this guide no how to proceed if you do find evidence of compromise.</p>
<p>The <code>whois</code> command can be run on IP addresses and will tell you what all the information about the organization that the IP is registered to, including the country.</p>
<h2 id="Check-2-Who-has-logged-in"><a href="#Check-2-Who-has-logged-in" class="headerlink" title="Check 2 - Who has logged in?"></a>Check 2 - Who has logged in?</h2><p>Linux servers keep a record of which users logged in, from what IP, when and for how long. This information is accessed with the <code>last</code> command.</p>
<p>The output looks like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root     pts/1        78.31.109.1      Thu Nov 30 08:26   still logged in</span><br><span class="line">root     pts/0        113.174.161.1    Thu Nov 30 08:26   still logged in</span><br><span class="line">root     pts/1        78.31.109.1      Thu Nov 30 08:24 - 08:26  (00:01)</span><br><span class="line">root     pts/0        113.174.161.1    Wed Nov 29 12:34 - 12:52  (00:18)</span><br><span class="line">root     pts/0        14.176.196.1     Mon Nov 27 13:32 - 13:53  (00:21)</span><br></pre></td></tr></table></figure>
<p>There is a mix of my UK IP’s and some Vietnamese ones, with the top two still logged in. If you see any IP’s that are not authorized then refer to the final section.</p>
<p>The login history is contained in a text file at <code>~/.bash_history</code> and is therefore easily removable. Often, attackers will simply delete this file to try to cover their tracks. Consequently, if you run <code>last</code> and only see your current login, this is a <strong>Bad Sign</strong>.</p>
<p>If there is no login history be very, very suspicious and continue looking for indications of compromise.</p>
<h2 id="Check-3-Review-the-command-history"><a href="#Check-3-Review-the-command-history" class="headerlink" title="Check 3 - Review the command history"></a>Check 3 - Review the command history</h2><p>This level of attacker will frequently take no precautions to leave no command history so running the <code>history</code> command will show you everything they have done. Be on the lookout for <code>wget</code> or <code>curl</code> commands to download out-of-repo software such as spam bots or crypto miners.</p>
<p>The command history is contained in the <code>~/.bash_history</code> file so some attackers will delete this file to cover what they have done. Just as with the login history, if you run <code>history</code> and don’t see anything then the history file has been deleted. Again this is a <strong>Bad Sign</strong> and you should review the server very carefully.</p>
<h2 id="Check-4-What’s-using-all-the-CPU"><a href="#Check-4-What’s-using-all-the-CPU" class="headerlink" title="Check 4 - What’s using all the CPU?"></a>Check 4 - What’s using all the CPU?</h2><p>The sorts of attackers that you will encounter usually don’t take too many precautions to hide what they are doing. So they will run processes that consume all the CPU. This generally makes it pretty easy to spot them. Simply run <code>top</code> and look at the highest process.</p>
<p>This will also show people exploiting your server without having logged in. This could be, for example, someone using an unprotected form-mail script to relay spam.</p>
<p>If you don’t recognize the top process then either Google its name or investigate what it’s doing with <code>losf</code> or <code>strace</code>.</p>
<p>To use these tools first copy its PID from <code>top</code> and run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace -p PID</span><br></pre></td></tr></table></figure>
<p>This will display all the system calls the process is making. It’s a lot of information but looking through it will give you a good idea what’s going on.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof  -p PID</span><br></pre></td></tr></table></figure>
<p>This program will <strong>l</strong>i<strong>s</strong>t the <strong>o</strong>pen <strong>f</strong>iles that the process has. Again, this will give you a good idea what it’s doing by showing you what files it is accessing.</p>
<h2 id="Check-5-Review-the-all-the-system-processes"><a href="#Check-5-Review-the-all-the-system-processes" class="headerlink" title="Check 5 - Review the all the system processes"></a>Check 5 - Review the all the system processes</h2><p>If an unauthorized process is not consuming enough CPU to get listed noticeably on <code>top</code> it will still get displayed in a full process listing with <code>ps</code>. My proffered command is <code>ps auxf</code> for providing the most information clearly.</p>
<p>You should be looking for any processes that you don’t recognize. The more times you run <code>ps</code> on your servers (which is a good habit to get into) the more obvious an alien process will stand out.</p>
<h2 id="Check-6-Review-network-usage-by-process"><a href="#Check-6-Review-network-usage-by-process" class="headerlink" title="Check 6 - Review network usage by process"></a>Check 6 - Review network usage by process</h2><p>The command <code>iftop</code> functions like <code>top</code> to show a ranked list of processes that are sending and receiving network data along with their source and destination. A process like a DOS attack or spam bot will immediately show itself at the top of the list.</p>
<h2 id="Check-7-What-processes-are-listening-for-network-connections"><a href="#Check-7-What-processes-are-listening-for-network-connections" class="headerlink" title="Check 7 - What processes are listening for network connections?"></a>Check 7 - What processes are listening for network connections?</h2><p>Often an attacker will install a program that doesn’t do anything except listen on the network port for instructions. This does not consume CPU or bandwidth whilst it is waiting so can get overlooked in the <code>top</code> type commands.</p>
<p>The commands <code>lsof</code> and <code>netstat</code> will both list all networked processes. I use them with the following options:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsof -i</span><br><span class="line">netstat -plunt</span><br></pre></td></tr></table></figure>
<p>You should look for any process that is listed as in the <code>LISTEN</code> or <code>ESTABLISHED</code> status as these processes are either waiting for a connection (LISTEN) or have a connection open (ESTABLISHED). If you don’t recognize these processes use <code>strace</code> or <code>lsof</code> to try to see what they are doing.</p>
<h2 id="What-should-I-do-if-I’ve-been-compromised"><a href="#What-should-I-do-if-I’ve-been-compromised" class="headerlink" title="What should I do if I’ve been compromised?"></a>What should I do if I’ve been compromised?</h2><p>The first thing to do is not to panic, especially if the attacker is currently logged in. You need to be able to take back control of the machine before the attacker is aware that you know about them. If they realize you know about them they may well lock you out of your server and start destroying any assets out of spite.</p>
<p>If you are not very technical then simply shut down the server. Either from the server itself with <code>shutdown -h now</code> or <code>systemctl poweroff</code>. Or log into your hosting provider’s control panel and shut down the server. Once it’s powered off you can work on the needed firewall rules and consult with your provider in your own time.</p>
<p>If you’re feeling a bit more confident and your hosting provider has an upstream firewall then create and enable the following two rules in this order:</p>
<ol>
<li>Allow SSH traffic from only your IP address.</li>
<li>Block <strong>everything</strong> else, not just SSH but every protocol on every port.</li>
</ol>
<p>This will immediately kill their SSH session and give only you access to the server.</p>
<p>If you don’t have access to an upstream firewall then you will have to create and enable these firewall rules on the server itself and then, when they are in place kill the attacker’s ssh session with the <code>kill</code> command.</p>
<p>A final method, where available, is to log into the server via an out-of-band connection such as the serial console and stop networking with <code>systemctl stop network.service</code>. This will completely stop any network access so you can now enable the firewall rules in your own time.</p>
<p>Once you have regained control of the server <strong>do not trust it</strong>.</p>
<p>Do not attempt to fix things up and continue using the server. You can never be sure what the attacker did and so you can never sure the server is secure.</p>
<p>The <strong>only sensible</strong> course of action is to copy off all the data that you need and start again from a fresh install.</p>
<h1 id="Fin"><a href="#Fin" class="headerlink" title="Fin"></a>Fin</h1>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Security/">Security</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Security/">Security</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Network/IO/libevent进阶" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/27/Network/IO/libevent进阶/" class="article-date">
      <time datetime="2019-04-27T14:12:13.000Z" itemprop="datePublished">2019-04-27</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/27/Network/IO/libevent进阶/">libevent进阶</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="libevent进阶"><a href="#libevent进阶" class="headerlink" title="libevent进阶"></a>libevent进阶</h2><p>之前一篇学了libevent基础，之后陆陆续续用到了一些进阶知识，遂另起此篇记录。</p>
<h3 id="编译参数"><a href="#编译参数" class="headerlink" title="编译参数"></a>编译参数</h3><p>gcc link lib：<code>-levent</code> .</p>
<p>因为我是在mac下用brew安装的，所以我的<strong>cmake</strong>这么写：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(APPLE)</span><br><span class="line">    <span class="keyword">include_directories</span>(/usr/local/Cellar/libevent/<span class="number">2.1</span>.<span class="number">8</span>/<span class="keyword">include</span>)</span><br><span class="line">    <span class="keyword">link_directories</span>(/usr/local/Cellar/libevent/<span class="number">2.1</span>.<span class="number">8</span>/lib)</span><br><span class="line"><span class="keyword">endif</span>(APPLE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(server main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(server event)</span><br></pre></td></tr></table></figure>
<p>目录可以用 <code>brew info libevent</code> 查找。</p>
<h3 id="Centos-安装开发环境"><a href="#Centos-安装开发环境" class="headerlink" title="Centos 安装开发环境"></a>Centos 安装开发环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libevent-devel</span><br></pre></td></tr></table></figure>
<h3 id="libevent多线程"><a href="#libevent多线程" class="headerlink" title="libevent多线程"></a>libevent多线程</h3><p>libevent 默认不开启多线程支持，所以在其他线程对 event 进行操作时无法唤醒事件。</p>
<p>这里总结一下 libevent 在多线程下最简单的使用需要添加的内容。</p>
<hr>
<ul>
<li><p>头文件 + <code>&lt;event2/thread.h&gt;</code></p>
</li>
<li><p>event_base 创建前 + <code>evthread_use_pthreads();</code></p>
</li>
<li><p>// event_base 创建后 + <code>evthread_make_base_notifiable(ev_base);</code></p>
<p>Make sure it’s safe to tell an event base to wake up from another thread or a signal handler.</p>
<p>如果不添加这句程序也能正常运行，我暂时认为这是一种确保，即如果返回-1表明失败，否则无用。</p>
</li>
<li><p>event 创建时 + <code>BEV_OPT_THREADSAFE</code></p>
</li>
<li><p>链接库 + <code>event_pthreads</code></p>
</li>
</ul>
<hr>
<h3 id="connect-timeout"><a href="#connect-timeout" class="headerlink" title="connect timeout"></a>connect timeout</h3><p><code>bufferevent_socket_connect</code> 连接的 timeout 是操作系统默认的 75s。</p>
<p>而 <code>bufferevent_set_timeouts</code> 只能设置读/写的timeout。</p>
<p>所以想让 <code>bufferevent_set_timeouts</code> 设置生效必须要在connect的时候开启bev的读(而一般做法是连接成功之后才开启读)。</p>
<p><code>bufferevent_enable(bev, EV_READ | EV_WRITE);</code></p>
<h3 id="libevent-SSL"><a href="#libevent-SSL" class="headerlink" title="libevent+SSL"></a>libevent+SSL</h3><h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Network/">Network</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IO/">IO</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Network/">Network</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/Programming/守护进程的创建" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/25/Linux/Programming/守护进程的创建/" class="article-date">
      <time datetime="2019-04-25T11:39:20.000Z" itemprop="datePublished">2019-04-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/Linux/Programming/守护进程的创建/">守护进程的创建</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>转自：<a href="http://blog.chinaunix.net/uid-25365622-id-3055635.html" target="_blank" rel="noopener">http://blog.chinaunix.net/uid-25365622-id-3055635.html</a></p>
<h2 id="守护进程的创建"><a href="#守护进程的创建" class="headerlink" title="守护进程的创建"></a>守护进程的创建</h2><p>守护进程（Daemon）是运行在后台的一种特殊进程。它独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件。</p>
<ol>
<li><p>使进程在后台运行</p>
<p>创建子进程父进程退出</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>((pid = fork())&gt;<span class="number">0</span>)</span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(pid&lt;<span class="number">0</span>) &#123;</span><br><span class="line">    perror(<span class="string">"fail to fork"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>脱离控制终端，登录会话和进程组（创建新会话）</p>
<p>进程属于一个进程组，进程组号（GID）就是进程组长的进程号（PID）。登录会话可以包含多个进程组。这些进程组共享一个控制终端。这个控制终端通常是创建进程的登录终端。 控制终端，登录会话和进程组通常是从父进程继承下来的。我们的目的就是要摆脱它们，使之不受它们的影响。方法是在第1点的基础上，调用setsid()使进程成为会话组长。</p>
<p>说明：当进程是会话组长时setsid()调用失败。但第一点已经保证进程不是会话组长。</p>
<p>setsid()调用成功后，进程成为新的会话组长和新的进程组长，并与原来的登录会话和进程组脱离。由于会话过程对控制终端的独占性，进程同时与控制终端脱离。</p>
<p>The <code>setsid()</code> function creates a new session.  The calling process is the session leader of the new session, is the process group leader of a new process group and has no controlling terminal.</p>
</li>
<li><p>禁止进程重新打开控制终端 (非必要)</p>
<p>现在，进程已经成为无终端的会话组长。但它可以重新申请打开一个控制终端。可以通过使进程不再成为会话组长来禁止进程重新打开控制终端： </p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(pid=fork()) </span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">//结束第一子进程，第二子进程继续（第二子进程不再是会话组长）</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭所有文件描述符</p>
<p>进程从创建它的父进程那里继承了打开的文件描述符。如不关闭，将会浪费系统资源，造成进程所在的文件系统无法卸下以及引起无法预料的错误:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;=getdtablesize(); i++)</span><br><span class="line">		close(i);</span><br></pre></td></tr></table></figure>
</li>
<li><p>改变当前工作目录 </p>
<p>进程活动时，其工作目录所在的文件系统不能卸下。一般需要将工作目录改变到根目录<code>/</code>。对于需要转储核心，写运行日志的进程将工作目录改变到特定目录如<code>/tmp</code>:</p>
<p><code>chdir(&quot;/&quot;) ;</code></p>
</li>
<li><p>重设权限掩码</p>
<p>进程从创建它的父进程那里继承了文件创建掩码。它可能修改守护进程所创建的文件的存取位。为防止这一点，将文件创建掩码清除：</p>
<p><code>umask(0);</code></p>
</li>
<li><p>处理SIGCHLD信号 (非必要)</p>
<p>处理SIGCHLD信号并不是必须的。但对于某些进程，特别是服务器进程往往在请求到来时生成子进程处理请求。如果父进程不等待子进程结束，子进程将成为僵尸进程（zombie）从而占用系统资源。如果父进程等待子进程结束，将增加父进程的负担，影响服务器进程的并发性能。在Linux下可以简单地将 SIGCHLD信号的操作设为SIG_IGN。 </p>
<p><code>signal(SIGCHLD,SIG_IGN);</code> </p>
<p>这样，内核在子进程结束时不会产生僵尸进程。这一点与BSD4不同，BSD4下必须显式等待子进程结束才能释放僵尸进程。</p>
</li>
</ol>
<p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*name: init_deamon.c</span></span><br><span class="line"><span class="comment"> *function:创建一个守护进程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/param.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt; </span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_deamon</span><span class="params">(<span class="keyword">void</span>)</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">int</span> pid; </span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 处理SIGCHLD信号。处理SIGCHLD信号并不是必须的。但对于某些进程，特别是服务器进程往往在请求到来时生成子进程处理请求。如果父进程不等待子进程结束，子进程将成为僵尸进程（zombie）从而占用系统资源。*/</span></span><br><span class="line">    <span class="keyword">if</span>(signal(SIGCHLD,SIG_IGN) == SIG_ERR)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Cant signal in init_daemon."</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pid=fork()) </span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">//是父进程，结束父进程 </span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid&lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);<span class="comment">//fork失败，退出</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//是第一子进程，后台继续执行</span></span><br><span class="line">    setsid();<span class="comment">//第一子进程成为新的会话组长和进程组长,并与控制终端分离</span></span><br><span class="line">    <span class="keyword">if</span>(pid=fork())</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">//是第一子进程，结束第一子进程 </span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid&lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);<span class="comment">//fork失败，退出</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//是第二子进程，不再是会话组长</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt; getdtablesize();++i)<span class="comment">//关闭打开的文件描述符</span></span><br><span class="line">        close(i); </span><br><span class="line">    chdir(<span class="string">"/tmp"</span>);<span class="comment">//改变工作目录到/tmp</span></span><br><span class="line">    umask(<span class="number">0</span>);<span class="comment">//重设文件创建掩码</span></span><br><span class="line">    <span class="keyword">return</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* name :test.c</span></span><br><span class="line"><span class="comment"> * function :调用init_deamon函数使进程变成守护进程，然后每一秒向/tmp目录下的print_time文件打印当前时间</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_deamon</span><span class="params">(<span class="keyword">void</span>)</span></span>;<span class="comment">//守护进程初始化函数 </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    FILE *fp; </span><br><span class="line">    <span class="keyword">time_t</span> t; </span><br><span class="line">    init_deamon();<span class="comment">//初始化为Daemon </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)<span class="comment">//每隔一分钟向test.log报告运行状态 </span></span><br><span class="line">    &#123; </span><br><span class="line">        sleep(<span class="number">1</span>);<span class="comment">//睡眠一秒钟 </span></span><br><span class="line">        <span class="keyword">if</span>((fp=fopen(<span class="string">"print_time"</span>,<span class="string">"a"</span>)) &gt;=<span class="number">0</span>) </span><br><span class="line">        &#123; </span><br><span class="line">            t=time(<span class="number">0</span>); </span><br><span class="line">            <span class="built_in">fprintf</span>(fp,<span class="string">"The time right now is : %s"</span>,asctime(localtime(&amp;t))); </span><br><span class="line">            fclose(fp); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-C-C++/Concept-gcc/attribute-packed" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/25/C-C++/Concept-gcc/attribute-packed/" class="article-date">
      <time datetime="2019-04-25T06:43:11.000Z" itemprop="datePublished">2019-04-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/C-C++/Concept-gcc/attribute-packed/">__attribute__</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>学习自：<a href="http://blog.chinaunix.net/uid-25768133-id-3485479.html" target="_blank" rel="noopener">http://blog.chinaunix.net/uid-25768133-id-3485479.html</a></p>
<h3 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h3><p>GNU C的一大特色就是<code>__attribute__</code>机制。<code>__attribute__</code>可以设置函数属性（Function Attribute）、变量属性（Variable Attribute）和类型属性（Type Attribute）。</p>
<p><strong>语法格式</strong>：</p>
<p><code>__attribute__ ((attribute-list))</code></p>
<p>其位置约束：放于声明的尾部“；”之前。</p>
<h3 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h3><h4 id="attribute-packed"><a href="#attribute-packed" class="headerlink" title="__attribute__((packed))"></a><code>__attribute__((packed))</code></h4><p>作用：让编译器取消结构在编译过程中的优化对齐，按照实际占用字节数进行对齐，即对变量是一字节对齐，对域（field）是位对齐。。</p>
<p>这是GCC特有的语法，gcc默认是非紧凑模式的。</p>
<p>在TC下：<code>struct my{ char ch; int a;}</code> sizeof(int)=2;sizeof(my)=3;（紧凑模式）</p>
<p>在GCC下：<code>struct my{ char ch; int a;}</code> sizeof(int)=4;sizeof(my)=8;（非紧凑模式）</p>
<p>在GCC下：<code>struct my{ char ch; int a;}__attrubte__ ((packed))</code> sizeof(int)=4;sizeof(my)=5</p>
<h4 id="attribute-noreturn"><a href="#attribute-noreturn" class="headerlink" title="__attribute__((noreturn))"></a><code>__attribute__((noreturn))</code></h4><p>告诉编译器这个函数不会返回给调用者，以便编译器在优化时去掉不必要的函数返回代码。</p>
<h3 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h3><p>以后遇到了再添加。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/C-C/">C/C++</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017-2022 Skuaka
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="A fast, simple &amp; powerful blog framework">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="Another simple and elegant theme for Hexo  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit" title="Site Visitors"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit" title="Page Hits"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 1;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="Back to Top"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="Comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="Go to Bottom"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>